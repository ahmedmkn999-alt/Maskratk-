<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>منصة معسكراتك | الأكاديمية الشاملة</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        :root { --primary: #FFD700; --bg: #050505; --panel: #151515; --text: #fff; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Cairo', sans-serif; }
        body { background: var(--bg); color: var(--text); overflow-x: hidden; }

        /* شاشة الدخول */
        #login-gate { position: fixed; inset: 0; background: #000; z-index: 999; display: flex; align-items: center; justify-content: center; flex-direction: column; }
        .gate-box { background: #111; padding: 40px; border-radius: 20px; border: 1px solid #333; text-align: center; width: 90%; max-width: 400px; }
        .gate-input { width: 100%; padding: 15px; margin: 20px 0; background: #000; border: 1px solid #333; color: var(--primary); text-align: center; font-size: 1.2rem; border-radius: 10px; }
        .gate-btn { background: var(--primary); color: #000; padding: 10px 40px; border: none; border-radius: 50px; font-weight: bold; cursor: pointer; }

        /* الهيدر */
        header { padding: 20px 5%; background: #111; border-bottom: 1px solid #333; display: flex; flex-direction: column; gap: 15px; }
        .top-bar { display: flex; justify-content: space-between; align-items: center; }
        .brand { font-weight: 800; font-size: 1.5rem; color: #fff; }
        .brand span { color: var(--primary); }
        
        /* شريط التنقل */
        .breadcrumbs { display: flex; gap: 10px; font-size: 0.9rem; color: #888; align-items: center; overflow-x: auto; white-space: nowrap; }
        .breadcrumb-item { cursor: pointer; transition: 0.2s; }
        .breadcrumb-item:hover { color: #fff; }
        .breadcrumb-item.active { color: var(--primary); font-weight: bold; cursor: default; }
        .separator { color: #444; }

        /* المحتوى */
        #platform { display: none; min-height: 100vh; }
        .container { padding: 30px 5%; max-width: 1400px; margin: 0 auto; }

        /* Grid Cards */
        .grid-view { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 20px; animation: fadeIn 0.5s; }
        .card { background: var(--panel); border: 1px solid #333; border-radius: 15px; overflow: hidden; cursor: pointer; transition: 0.3s; text-align: center; padding-bottom: 15px; }
        .card:hover { transform: translateY(-5px); border-color: var(--primary); }
        .card-img { width: 100%; height: 160px; object-fit: cover; background: #222; }
        .card-title { font-weight: 700; margin-top: 15px; font-size: 1.1rem; padding: 0 10px; }
        .card-subtitle { font-size: 0.85rem; color: #888; margin-top: 5px; }

        /* واجهة الفيديو */
        .video-layout { display: none; grid-template-columns: 1fr 350px; gap: 20px; height: calc(100vh - 150px); animation: fadeIn 0.5s; }
        .video-container { background: #000; border-radius: 15px; overflow: hidden; display: flex; flex-direction: column; border: 1px solid #333; }
        .player-wrapper { flex: 1; background: #000; position: relative; }
        video { width: 100%; height: 100%; }
        
        .playlist { background: var(--panel); border-radius: 15px; border: 1px solid #333; overflow-y: auto; display: flex; flex-direction: column; }
        .playlist-header { padding: 15px; background: #222; font-weight: bold; border-bottom: 1px solid #333; position: sticky; top: 0; }
        
        .chapter-group { border-bottom: 1px solid #333; }
        .chapter-title { padding: 12px 15px; background: #1a1a1a; cursor: pointer; display: flex; justify-content: space-between; font-size: 0.9rem; color: #aaa; }
        .videos-list { display: none; }
        .videos-list.open { display: block; }
        .video-item { padding: 12px 15px; border-bottom: 1px solid #222; cursor: pointer; display: flex; align-items: center; font-size: 0.9rem; transition: 0.2s; background: #111; }
        .video-item:hover { background: #222; }
        .video-item.active { background: rgba(255, 215, 0, 0.1); border-right: 3px solid var(--primary); color: var(--primary); }

        .error-overlay { position: absolute; inset: 0; background: rgba(0,0,0,0.9); color: #ff4444; display: none; flex-direction: column; align-items: center; justify-content: center; z-index: 10; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @media (max-width: 900px) { .video-layout { grid-template-columns: 1fr; height: auto; } .playlist { max-height: 500px; } }
    </style>
</head>
<body>

    <div id="login-gate">
        <div class="gate-box">
            <h1 style="color: #fff; margin-bottom: 10px;">أكاديمية معسكراتك</h1>
            <input type="password" id="access-code" class="gate-input" placeholder="الكود السري">
            <button class="gate-btn" onclick="checkCode()">دخول</button>
            <p id="error-msg" style="color: red; margin-top: 10px; display: none;">الكود غير صحيح</p>
        </div>
    </div>

    <div id="platform">
        <header>
            <div class="top-bar">
                <div class="brand">MASK<span>ARATAK</span></div>
                <div id="user-name" style="color: #888; font-size: 0.9rem;">طالب</div>
            </div>
            <div class="breadcrumbs" id="breadcrumbs"></div>
        </header>

        <div class="container">
            <div id="grid-container" class="grid-view"></div>
            <div id="video-layout" class="video-layout">
                <div class="video-container">
                    <div class="player-wrapper">
                        <div id="error-overlay" class="error-overlay"><h3>⚠️ الرابط منتهي</h3></div>
                        <video id="main-player" controls playsinline></video>
                    </div>
                    <div style="padding: 15px; border-top: 1px solid #333;">
                        <h3 id="current-video-title" style="color: var(--primary);">اختر درساً</h3>
                    </div>
                </div>
                <div class="playlist" id="playlist-container"></div>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, query, where, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAVWCxTVgg3i25jJ0LbZOxpB4mfQc_BnQs",
            authDomain: "maskratk.firebaseapp.com",
            projectId: "maskratk",
            storageBucket: "maskratk.firebasestorage.app",
            messagingSenderId: "857906406354",
            appId: "1:857906406354:web:c19538fd2824b9a64d5e0b",
            measurementId: "G-E3018VB921"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // --- البيانات الكاملة ---
        const rawData = [
  {
    "subjects": [
      {
        "subject_id": 40,
        "subject_name": "لغة عربية",
        "image_url": "https://files.coursatk.online/images/questions/c91723a0f73a35ed26c7c35a47d99f7e02c66e55b552.jpg",
        "teachers": [
          {
            "id": 110,
            "name": "أ.محمد صلاح",
            "image_url": "https://files.coursatk.online/images/questions/abc2fcc42883dd1a9e93021922da73dc92ff4b40ec76.jpg",
            "chapters": [
              {
                "chapter_id": 526,
                "chapter_name": "الشهر الأول",
                "image_url": "https://files.coursatk.online/images/questions/0c36735d5f3c11b26977e03a493f76fdd7b01b768174.jpg",
                "lectures": [ { "lecture_name": "المحاضرة الأولى", "videos": [ { "video_name": "النحو - المبتدأ والخبر", "links": [ { "url": "https://river-5-545.rtbcdn.ru/hls-vod/lMLIGlXXPat9W2owCUKuWw/1770646511/3320/0x5000c500e9daa4c6/c24ad275e16e460e8f576a81bf0d7ba5.mp4.m3u8" } ] }, { "video_name": "الأدب - المدرسة الكلاسيكية", "links": [ { "url": "https://river-5-554.rtbcdn.ru/hls-vod/1ZxXO6yUAYubNz9iuqRsZg/1770665380/3358/0x5000c500fa77c05c/724a5005e0794f1db5e6b027aa11372b.mp4.m3u8" } ] } ] }, { "lecture_name": "المحاضرة الثانية", "videos": [ { "video_name": "النحو - كان وأخواتها", "links": [ { "url": "https://river-4-423.rtbcdn.ru/hls-vod/diCXmj7MH1qQPGI3dFBrLQ/1770482585/3314/0x5000c500e9c92040/9bc2abaa0044472ea9ca39c392fa081b.mp4.m3u8" } ] } ] } ]
              },
              {
                "chapter_id": 667,
                "chapter_name": "معسكر 4 - 1",
                "image_url": "https://files.coursatk.online/images/content/20260118_48949ddc990f24bf33c277c07b266eb9.jpg",
                "lectures": [ { "lecture_name": "المهمة الأولى", "videos": [ { "video_name": "مقدمة المهمة الأولي", "links": [ { "url": "https://river-4-404.rtbcdn.ru/hls-vod/EHn5i5DByob8O9pOLkRvmg/1770645966/3310/0x5000c500e9b6282b/f6c8e8d620f3450495303e888fe1ede1.mp4.m3u8" } ] }, { "video_name": "شرح الـنحو", "links": [ { "url": "https://river-4-429.rtbcdn.ru/hls-vod/pY6nkzrcG4lHcv1P_FKB1w/1770639813/3322/0x5000c500e9ebd5af/7ed17944068f431bbc6a44ed612999bd.mp4.m3u8" } ] } ] }, { "lecture_name": "المهمة الثانية", "videos": [ { "video_name": "مقدمة المهمة الثانية", "links": [ { "url": "https://river-5-545.rtbcdn.ru/hls-vod/lVBag9yn1BYVPgdYRB1A5w/1770586902/1846/0x5000c500c9224fc5/257dfabdc1fe4de9945d126dc5ee9e94.mp4.m3u8" } ] } ] } ]
              }
            ]
          }
        ]
      },
      {
        "subject_id": 48,
        "subject_name": "رياضة",
        "image_url": "https://files.coursatk.online/images/subjects/math.png",
        "teachers": [
          {
            "id": 136,
            "name": "م.احمد عصام",
            "image_url": "https://files.coursatk.online/images/questions/954b4af4a74f55705aa828d1e05adf6a84a41c5a5fba.jpg",
            "chapters": [
              {
                "chapter_id": 678, "chapter_name": "كورس الديناميكا", "image_url": "https://files.coursatk.online/images/content/20260131_2061075e0bcd1e17611e511765dc57ac.jpg",
                "lectures": [ { "lecture_name": "المحاضرة الأولى", "videos": [ { "video_name": "الحصة الأولى", "links": [ { "url": "https://river-3-379.rtbcdn.ru/hls-vod/06STGPfnWguOTNuFlMZgMQ/1770751943/2618/0x5000039ce868e9d9/22b8200bea934ba5a9dd9774119704a2.mp4.m3u8" } ] } ] } ]
              },
              {
                "chapter_id": 648, "chapter_name": "باقي التفاضل والتكامل", "image_url": "https://files.coursatk.online/images/content/20251229_a2ee2745fd5331d143e40891de362294.jpg",
                "lectures": [ { "lecture_name": "تكامل 4", "videos": [ { "video_name": "الحصة الرابعة", "links": [ { "url": "https://river-3-363.rtbcdn.ru/hls-vod/i1dT0B2Rn0XoyK4Pp-v9Mw/1770756754/2584/0x5000039ce8690105/0a9fc63f63de4d91996c5d4e34a5c783.mp4.m3u8" } ] } ] } ]
              }
            ]
          },
          {
            "id": 137,
            "name": "م. لطفي زهران",
            "image_url": "https://files.coursatk.online/images/questions/e058a83e533993956c70599fb7d611f340ae22be9503.jpg",
            "chapters": [
              {
                "chapter_id": 650, "chapter_name": "عسكر في اللامعسكر", "image_url": "https://files.coursatk.online/images/content/20260102_e329cdbf26ec06bab48b0b4834b23a79.jpg",
                "lectures": [ { "lecture_name": "معسكر الفراغية", "videos": [ { "video_name": "معسكر شرح فرع الفراغية", "links": [ { "url": "https://river-3-343.rtbcdn.ru/hls-vod/q2gpG37FzyJ0GlwCyYCAxg/1770654567/3290/0x5000c500fa6e36fa/b184d50653474fb4b3c5e2dd9e391798.mp4.m3u8" } ] } ] }, { "lecture_name": "معسكر التفاضل", "videos": [ { "video_name": "معسكر شرح وحل تدريبات فرع التفاضل", "links": [ { "url": "https://river-4-438.rtbcdn.ru/hls-vod/o_7aNJq0wlu2b0NBv-IewQ/1770575338/3328/0x5000c500e9cf20fb/1c675b2e1dcc47a8a1e2094ecec08f01.mp4.m3u8" } ] } ] }, { "lecture_name": "معسكر التكامل", "videos": [ { "video_name": "معسكر شرح وحل تدريبات فرع التكامل", "links": [ { "url": "https://river-5-528.rtbcdn.ru/hls-vod/ejz5xDnvt-dY2r44s0cc8Q/1770581712/3324/0x5000c500e9ebf8ce/25fab5123c3344a39fd33ffcc15a312d.mp4.m3u8" } ] } ] } ]
              },
              {
                "chapter_id": 672, "chapter_name": "الاستاتيكا", "image_url": "https://files.coursatk.online/images/content/20260126_832cccca202a6aff45c4304bcc2b0576.jpg",
                "lectures": [ { "lecture_name": "متطلبات قبلية", "videos": [ { "video_name": "متطلبات قبلية الجزء الأول", "links": [ { "url": "https://river-3-388.rtbcdn.ru/hls-vod/mG1x7qQoPT78B0KIqFR7ow/1770819273/2508/0x5000039ce86869e1/77b1ce0172484deaae9bba26e3bddbc3.mp4.m3u8" } ] } ] } ]
              }
            ]
          }
        ]
      },
      {
        "subject_id": 46,
        "subject_name": "جغرافيا",
        "image_url": "https://files.coursatk.online/images/subjects/geography.png",
        "teachers": [
          {
            "id": 132,
            "name": "جمعة السيد",
            "image_url": "https://files.coursatk.online/images/content/2b233a89685a724df18a65c7b2ba6a3263f2932b3e8a.jpg",
            "chapters": [
              {
                "chapter_id": 662, "chapter_name": "الشهر الخامس", "image_url": "https://files.coursatk.online/images/content/20260111_5b00feba4a65abdeb0b55487df88f6cc.jpg",
                "lectures": [ { "lecture_name": "الأسبوع الرابع والاخير", "videos": [ { "video_name": "شرح المشكلات الاجتماعية كامل", "links": [ { "url": "https://river-3-312.rtbcdn.ru/hls-vod/qEmQG7_j9IxPTD7tdyYxsg/1770826539/3326/0x5000c500e9d3839b/2db0791c39644f7abb18f9ad9922b096.mp4.m3u8" } ] } ] }, { "lecture_name": "الأسبوع الثالث", "videos": [ { "video_name": "المشكلات الاقتصادية", "links": [ { "url": "https://river-5-554.rtbcdn.ru/hls-vod/I8h6fTlXKQd8REfpxukpVg/1770731271/1905/0x5000c500e539f15d/c7108a5eb57e46bfab705dde7a6128d2.mp4.m3u8" } ] } ] } ]
              }
            ]
          },
          {
            "id": 133,
            "name": "أحمد زهران",
            "image_url": "https://files.coursatk.online/images/questions/5eab71b642c6672b9182be0d1dd887beb3c8d2b98cf2.jpg",
            "chapters": [
              {
                "chapter_id": 656, "chapter_name": "الشهر الخامس", "image_url": "https://files.coursatk.online/images/content/20260107_723de52cef9ed0ba3100e2e1a216dad3.jpg",
                "lectures": [ { "lecture_name": "المحاضرة 18", "videos": [ { "video_name": "شرح الحصة 18", "links": [ { "url": "https://river-3-349.rtbcdn.ru/hls-vod/1RzkI1YooRj0A-Owz-NrUw/1770670174/1786/0x5000c500c5826c38/3a39fffdc58949a8b2d362b76afbe4c5.mp4.m3u8" } ] } ] }, { "lecture_name": "المحاضرة 17", "videos": [ { "video_name": "فيديو شرح الحصه ال سابعه عشر", "links": [ { "url": "https://river-5-528.rtbcdn.ru/hls-vod/Ymg2QbGAwPBarF-khhx9cw/1770837062/3398/0x5000c500fa6e8c72/cc4e141eeeef485f8997d330a3d400fc.mp4.m3u8" } ] } ] } ]
              }
            ]
          }
        ]
      }
    ]
  }
];

        let navigationState = { currentSubject: null, currentTeacher: null, currentChapter: null };

        // --- دوال التشغيل ---
        window.checkCode = async function() {
            const code = document.getElementById('access-code').value;
            // MASTER KEY: 2026 
            // هيدخلك فوراً حتى لو قاعدة البيانات فيها مشكلة
            if (code === "2026") {
                document.getElementById('user-name').innerText = "المدير (Master)";
                document.getElementById('login-gate').style.display = 'none';
                document.getElementById('platform').style.display = 'block';
                renderSubjects();
                return;
            }

            // لو الكود مش 2026، هيروح يدور في فايربيس
            const q = query(collection(db, "access_codes"), where("code", "==", code));
            try {
                const snapshot = await getDocs(q);
                if (!snapshot.empty) {
                    const data = snapshot.docs[0].data();
                    document.getElementById('user-name').innerText = data.name;
                    document.getElementById('login-gate').style.display = 'none';
                    document.getElementById('platform').style.display = 'block';
                    renderSubjects();
                } else {
                    document.getElementById('error-msg').innerText = "الكود غير صحيح";
                    document.getElementById('error-msg').style.display = 'block';
                }
            } catch(e) { 
                console.log(e); 
                // لو حصل خطأ في الاتصال، اعرض رسالة بس ما تمنعش الدخول لو الكود صح
                alert("في مشكلة في اتصال قاعدة البيانات، بس هحاول ادخلك...");
            }
        }

        function renderSubjects() {
            const grid = document.getElementById('grid-container');
            const vidLayout = document.getElementById('video-layout');
            grid.innerHTML = '';
            grid.style.display = 'grid';
            vidLayout.style.display = 'none';
            updateBreadcrumbs(0);

            const subjects = rawData[0].subjects;

            subjects.forEach(sub => {
                const card = createCard(sub.subject_name, 'مادة دراسية', sub.image_url);
                card.onclick = () => renderTeachers(sub);
                grid.appendChild(card);
            });
        }

        function renderTeachers(subject) {
            navigationState.currentSubject = subject;
            const grid = document.getElementById('grid-container');
            grid.innerHTML = '';
            updateBreadcrumbs(1);

            subject.teachers.forEach(teacher => {
                const card = createCard(teacher.name, subject.subject_name, teacher.image_url);
                card.onclick = () => renderChapters(teacher);
                grid.appendChild(card);
            });
        }

        function renderChapters(teacher) {
            navigationState.currentTeacher = teacher;
            const grid = document.getElementById('grid-container');
            grid.innerHTML = '';
            updateBreadcrumbs(2);

            teacher.chapters.forEach(chapter => {
                const card = createCard(chapter.chapter_name, teacher.name, chapter.image_url);
                card.onclick = () => renderVideosView(chapter);
                grid.appendChild(card);
            });
        }

        function renderVideosView(chapter) {
            navigationState.currentChapter = chapter;
            const grid = document.getElementById('grid-container');
            const vidLayout = document.getElementById('video-layout');
            const playlist = document.getElementById('playlist-container');
            
            grid.style.display = 'none';
            vidLayout.style.display = 'grid';
            updateBreadcrumbs(3);
            
            playlist.innerHTML = `<div class="playlist-header">${chapter.chapter_name}</div>`;

            chapter.lectures.forEach((lecture, index) => {
                const group = document.createElement('div');
                group.className = 'chapter-group';
                
                const title = document.createElement('div');
                title.className = 'chapter-title';
                title.innerHTML = `<span>${lecture.lecture_name}</span> <span>▼</span>`;
                
                const list = document.createElement('div');
                list.className = 'videos-list';
                if(index === 0) list.classList.add('open');

                title.onclick = () => list.classList.toggle('open');

                lecture.videos.forEach(vid => {
                    const vidItem = document.createElement('div');
                    vidItem.className = 'video-item';
                    vidItem.innerHTML = `<span>▶ ${vid.video_
